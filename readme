Benchmarking different hashmap implementations.
Uses macOS ARM performance counters and perf_event on Linux.

Run: ./build/hash (run under sudo on macOS for counters)

How to build:
    cmake -G Ninja -DCMAKE_BUILD_TYPE=Release -S . -B build
    cmake --build build

Compiler flags: -O3 -march=native, no LTO

Keys/values: uint64_t keys 1..N, values the same.

Hash functions:
* boost: boost::hash<uint64_t>
* twoway: squirrel3 hash
* absl: absl::Hash<uint64_t>
* std: std::hash<uint64_t>
* flat: std::flat_map<uint64_t, uint64_t> (sorted vector)

Capacity/load factor:
* boost/absl/std reserve(2*N) before inserts (the default).
* twoway grows as needed from capacity 8.
* flat stores N sorted pairs (contiguous).

Lookups grouped by N where
* rows = different hashmap implementation  
* cols = batch size (lookups per iteration, to test repeated lookups in a tight loop)
* cell = cycles per lookup / branch hit rate% / L1D hit rate% / LLC hit rate%
* hit rates use perf_event counters (L1D/LLC read accesses/misses), "na" if unavailable

Lookup sets:
* Spare elements: random uniform lookups
* Dense set of elements: sequential lookups (keys[i % N]).
* All lookups are hits.

Tested on:
* OS: Linux
* CPU: Intel Core i7-7700 @ 3.60GHz
* Cores/threads: 4 cores / 8 threads
* L3 cache: 8 MB
* No cpu pinning :(

------------------------------------------------------------------------------------------------------------------------------------------

                                                              Spare elements

                                                             N = 256 (1 << 8)
+--------+---------------+----------------+---------------+---------------+--------------+--------------+--------------+--------------+
| kind   |             1 |              2 |             4 |             8 |           16 |           32 |           64 |          128 |
+--------+---------------+----------------+---------------+---------------+--------------+--------------+--------------+--------------+
| boost  | 13/100/100/92 |   12/100/99/99 | 11/100/99/100 |  11/100/99/81 | 10/100/99/74 | 10/100/99/58 | 11/100/99/12 | 10/100/99/12 |
| twoway |   55/85/99/87 |   52/83/99/100 |   52/80/98/95 |   51/79/98/56 |  49/81/98/29 |  48/81/98/11 |  48/82/98/12 |  48/82/98/11 |
| absl   | 14/100/100/88 |  11/100/99/100 |  11/100/99/98 |  10/100/99/70 | 10/100/99/36 | 10/100/98/11 | 10/100/98/10 | 10/100/98/11 |
| fph    | 11/100/100/80 |    9/100/99/99 |   8/100/98/99 |   8/100/98/74 |  7/100/98/52 |  7/100/97/34 |  7/100/97/32 |  7/100/97/32 |
| std    | 30/100/100/78 |  29/100/99/100 |  28/100/99/98 |  28/100/99/65 | 28/100/99/30 | 28/100/99/18 | 28/100/99/16 | 28/100/99/16 |
| flat   | 150/80/100/88 | 157/76/100/100 | 151/77/100/78 | 146/78/100/80 | 144/78/99/66 | 143/79/99/63 | 142/79/99/62 | 142/79/99/56 |
+--------+---------------+----------------+---------------+---------------+--------------+--------------+--------------+--------------+


                                                            N = 1024 (1 << 10)
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| kind   |             1 |             2 |             4 |             8 |            16 |            32 |            64 |           128 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| boost  |  14/100/97/76 | 12/100/96/100 |  11/100/95/99 |  11/100/95/67 |  11/100/94/42 |  11/100/94/22 |  11/100/94/21 |  11/100/94/21 |
| twoway |   58/84/96/75 |  55/83/95/100 |   54/80/94/84 |   53/79/93/62 |   52/80/93/35 |   51/81/92/19 |   50/81/92/19 |   50/81/92/18 |
| absl   |  14/100/96/86 | 12/100/94/100 |  11/100/92/99 |  10/100/90/68 |  10/100/89/41 |  10/100/89/21 |  10/100/89/22 |  10/100/88/21 |
| fph    |  12/100/96/94 | 10/100/94/100 |  9/100/91/100 |   8/100/89/94 |   8/100/88/90 |   8/100/87/86 |   8/100/86/86 |   8/100/86/86 |
| std    |  30/100/93/72 |  29/100/91/99 |  28/100/90/99 |  28/100/89/58 |  28/100/88/31 |   28/100/88/9 |   28/100/87/6 |   28/100/87/5 |
| flat   | 192/77/100/84 | 199/74/100/93 | 191/75/100/91 | 188/76/100/78 | 186/76/100/71 | 185/76/100/70 | 185/76/100/70 | 184/76/100/71 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+


                                                            N = 4096 (1 << 12)
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| kind   |             1 |             2 |             4 |             8 |            16 |            32 |            64 |           128 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| boost  |  15/100/87/99 |  13/100/83/99 |  11/100/80/99 |  11/100/78/98 |  11/100/77/98 |  11/100/77/98 |  11/100/76/98 |  11/100/76/98 |
| twoway |  55/84/79/100 |  52/82/69/100 |  50/80/63/100 |  51/78/58/100 |  49/79/55/100 |  49/79/53/100 |  48/80/52/100 |  48/80/52/100 |
| absl   |  16/100/88/99 |  14/100/83/99 |  12/100/77/99 |  12/100/73/98 |  11/100/71/98 |  11/100/69/98 |  11/100/69/98 |  11/100/68/98 |
| fph    | 15/100/90/100 | 12/100/84/100 | 11/100/77/100 | 10/100/72/100 | 10/100/68/100 | 10/100/65/100 | 10/100/64/100 | 10/100/63/100 |
| std    | 31/100/79/100 | 30/100/72/100 | 29/100/67/100 | 28/100/64/100 | 28/100/62/100 | 28/100/61/100 | 28/100/60/100 | 28/100/60/100 |
| flat   | 232/76/90/100 | 239/74/88/100 |  231/75/86/99 |  227/75/86/99 |  226/75/85/99 |  225/75/85/99 |  224/75/85/99 |  224/75/85/99 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+


                                                           N = 16384 (1 << 14)
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| kind   |             1 |             2 |             4 |             8 |            16 |            32 |            64 |           128 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| boost  | 21/100/82/100 | 17/100/77/100 | 15/100/73/100 | 15/100/71/100 | 15/100/70/100 | 15/100/69/100 | 15/100/69/100 | 15/100/68/100 |
| twoway |  71/84/63/100 |  68/83/49/100 |  68/79/40/100 |  66/79/33/100 |  64/80/29/100 |  63/80/25/100 |  63/81/25/100 |  62/81/24/100 |
| absl   |  24/100/83/99 | 18/100/75/100 | 16/100/67/100 | 16/100/61/100 | 16/100/58/100 | 16/100/55/100 | 15/100/54/100 | 15/100/54/100 |
| fph    | 19/100/83/100 | 16/100/74/100 | 14/100/64/100 | 14/100/55/100 | 13/100/49/100 | 13/100/45/100 | 13/100/43/100 | 13/100/42/100 |
| std    | 40/100/77/100 | 36/100/70/100 | 35/100/65/100 | 34/100/61/100 | 34/100/59/100 | 34/100/58/100 | 34/100/57/100 | 33/100/57/100 |
| flat   | 301/76/29/100 | 307/74/19/100 | 299/75/13/100 |  296/75/9/100 |  294/75/7/100 |  293/75/6/100 |  330/75/5/100 |  293/75/5/100 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+


                                                           N = 65536 (1 << 16)
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| kind   |             1 |             2 |             4 |             8 |            16 |            32 |            64 |           128 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| boost  | 25/100/82/100 | 19/100/76/100 | 18/100/73/100 | 18/100/71/100 | 17/100/69/100 | 17/100/69/100 | 17/100/68/100 | 17/100/68/100 |
| twoway |  64/84/74/100 |  59/82/63/100 |  58/80/54/100 |  60/77/47/100 |  58/78/44/100 |  57/79/42/100 |  56/79/40/100 |  56/79/40/100 |
| absl   | 32/100/83/100 | 21/100/74/100 | 19/100/67/100 | 19/100/61/100 | 18/100/57/100 | 18/100/55/100 | 18/100/54/100 | 18/100/53/100 |
| fph    | 32/100/80/100 | 20/100/69/100 | 18/100/57/100 | 17/100/46/100 | 17/100/39/100 | 16/100/35/100 | 16/100/32/100 | 16/100/31/100 |
| std    | 48/100/74/100 | 38/100/66/100 | 38/100/60/100 | 37/100/57/100 | 37/100/54/100 | 36/100/53/100 | 36/100/53/100 | 36/100/52/100 |
| flat   |  424/76/0/100 |  430/74/0/100 |  422/75/0/100 |  419/75/0/100 |  417/75/0/100 |  416/75/0/100 |  415/75/0/100 |  415/75/0/100 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+

-------------------------------------------------------------------------------------------------------------------------------------------

                                                           Dense set of elements

                                                             N = 256 (1 << 8)
+--------+---------------+----------------+---------------+---------------+--------------+-------------+-------------+-------------+
| kind   |             1 |              2 |             4 |             8 |           16 |          32 |          64 |         128 |
+--------+---------------+----------------+---------------+---------------+--------------+-------------+-------------+-------------+
| boost  | 13/100/100/78 |   12/100/99/99 | 11/100/99/100 |  11/100/99/63 | 10/100/99/36 | 10/100/99/4 | 11/100/99/4 | 10/100/99/3 |
| twoway |  14/100/99/74 |  12/100/99/100 |  12/100/98/98 |  11/100/98/65 | 11/100/98/35 | 10/100/98/5 | 11/100/98/3 | 10/100/98/4 |
| absl   | 14/100/100/86 |  12/100/99/100 |  11/100/99/99 |  10/100/99/56 | 10/100/99/35 | 10/100/98/4 | 10/100/98/3 | 10/100/98/2 |
| fph    |  11/100/99/85 |   9/100/99/100 |   8/100/98/99 |   8/100/98/71 |  7/100/98/39 |  7/100/98/8 |  7/100/97/7 |  7/100/97/6 |
| std    | 30/100/100/71 |  29/100/99/100 |  28/100/99/99 |  28/100/99/61 | 28/100/99/33 | 28/100/99/5 | 28/100/99/5 | 28/100/99/4 |
| flat   | 32/100/100/72 | 29/100/100/100 | 27/100/100/99 | 27/100/100/63 | 26/100/99/29 | 27/100/99/3 | 26/100/99/2 | 26/100/99/2 |
+--------+---------------+----------------+---------------+---------------+--------------+-------------+-------------+-------------+


                                                            N = 1024 (1 << 10)
+--------+---------------+----------------+---------------+---------------+---------------+---------------+---------------+---------------+
| kind   |             1 |              2 |             4 |             8 |            16 |            32 |            64 |           128 |
+--------+---------------+----------------+---------------+---------------+---------------+---------------+---------------+---------------+
| boost  |  14/100/94/59 |  12/100/92/100 |  11/100/91/96 |  11/100/90/67 |  11/100/90/40 |  11/100/90/17 |  11/100/89/15 |  11/100/89/14 |
| twoway |  16/100/97/74 |  13/100/96/100 |  12/100/95/99 |  12/100/94/73 |  11/100/94/50 |  11/100/93/30 |  11/100/94/32 |  11/100/94/30 |
| absl   |  14/100/94/80 |  12/100/91/100 |  11/100/88/97 |  10/100/86/63 |  10/100/85/39 |  10/100/84/11 |  10/100/84/12 |  10/100/83/11 |
| fph    |  12/100/94/90 |  10/100/91/100 |   9/100/87/95 |   8/100/84/87 |   8/100/82/75 |   8/100/81/65 |   8/100/80/64 |   8/100/80/64 |
| std    |  30/100/95/60 |  29/100/93/100 |  28/100/91/92 |  28/100/90/25 |  28/100/90/25 |   28/100/90/4 |   28/100/90/3 |   28/100/89/4 |
| flat   | 138/86/100/86 | 128/86/100/100 | 135/85/100/86 | 136/85/100/74 | 131/85/100/60 | 129/85/100/60 | 128/85/100/63 | 128/85/100/62 |
+--------+---------------+----------------+---------------+---------------+---------------+---------------+---------------+---------------+


                                                            N = 4096 (1 << 12)
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| kind   |             1 |             2 |             4 |             8 |            16 |            32 |            64 |           128 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| boost  | 16/100/83/100 | 13/100/78/100 |  12/100/74/99 |  11/100/71/99 |  11/100/70/99 |  11/100/69/99 |  11/100/69/99 |  11/100/69/99 |
| twoway |  36/92/80/100 |  33/91/71/100 |  30/92/63/100 |  32/89/58/100 |  28/91/55/100 |  27/92/54/100 |  26/93/52/100 |  26/93/52/100 |
| absl   |  17/100/87/99 | 14/100/81/100 |  13/100/75/99 |  12/100/70/99 |  12/100/67/99 |  12/100/66/99 |  12/100/65/99 |  12/100/64/99 |
| fph    | 16/100/87/100 | 13/100/80/100 | 12/100/72/100 | 11/100/66/100 | 11/100/61/100 | 10/100/58/100 | 10/100/56/100 | 10/100/55/100 |
| std    |  30/100/95/85 |  29/100/93/99 |  28/100/91/95 |  28/100/91/86 |  28/100/90/80 |  28/100/90/72 |  28/100/90/73 |  28/100/90/71 |
| flat   |  152/86/99/95 |  149/85/99/98 |  154/84/98/94 |  156/84/98/90 |  149/85/98/89 |  146/85/98/88 |  145/85/98/88 |  145/85/98/88 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+


                                                            N = 16384 (1 << 14)
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| kind   |             1 |             2 |             4 |             8 |            16 |            32 |            64 |           128 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| boost  | 22/100/81/100 | 18/100/75/100 | 17/100/71/100 | 16/100/69/100 |  16/100/68/99 |  16/100/67/99 |  16/100/67/99 |  16/100/66/99 |
| twoway |  63/86/67/100 |  59/85/54/100 |  58/82/47/100 |  58/81/39/100 |  55/83/39/100 |  54/84/36/100 |  53/84/36/100 |  53/84/35/100 |
| absl   |  25/100/82/99 | 18/100/74/100 | 17/100/66/100 | 16/100/60/100 | 16/100/56/100 | 16/100/54/100 | 16/100/52/100 | 16/100/52/100 |
| fph    | 19/100/81/100 | 16/100/71/100 | 14/100/59/100 | 14/100/50/100 | 13/100/43/100 | 13/100/38/100 | 13/100/36/100 | 13/100/35/100 |
| std    |  31/100/95/93 |  29/100/93/96 |  28/100/92/93 |  28/100/91/91 |  28/100/90/90 |  28/100/90/89 |  28/100/90/90 |  28/100/90/89 |
| flat   |  144/89/99/98 |  144/88/98/99 |  153/87/98/97 |  154/87/98/96 |  143/88/98/96 |  141/88/98/96 |  140/88/98/96 |  140/88/98/96 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+


                                                            N = 65536 (1 << 16)
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| kind   |             1 |             2 |             4 |             8 |            16 |            32 |            64 |           128 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
| boost  | 25/100/81/100 | 20/100/75/100 | 19/100/72/100 | 19/100/70/100 | 19/100/68/100 | 19/100/68/100 | 19/100/67/100 | 19/100/67/100 |
| twoway |  59/85/76/100 |  56/83/64/100 |  55/82/55/100 |  57/79/50/100 |  54/80/46/100 |  53/81/44/100 |  53/81/43/100 |  53/81/41/100 |
| absl   | 33/100/82/100 | 20/100/73/100 | 19/100/65/100 | 18/100/59/100 | 18/100/55/100 | 18/100/53/100 | 18/100/52/100 | 18/100/51/100 |
| fph    | 33/100/80/100 | 19/100/68/100 | 18/100/56/100 | 17/100/46/100 | 17/100/38/100 | 16/100/34/100 | 16/100/31/100 | 16/100/30/100 |
| std    |  31/100/95/87 |  29/100/93/96 |  28/100/92/92 |  28/100/91/88 |  28/100/90/87 |  28/100/90/87 |  28/100/90/87 |  28/100/90/87 |
| flat   |  144/90/98/99 | 145/90/98/100 |  149/89/96/98 |  150/89/96/98 |  142/90/97/97 |  140/90/98/97 |  140/90/98/97 |  140/90/98/97 |
+--------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+---------------+
