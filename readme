Benchmarking different hashmap implementations.
Uses macOS ARM performance counters and perf_event on Linux.

Platform: Linux
Run: ./build/hash (run under sudo on macOS for counters)

How to build:
    cmake -G Ninja -DCMAKE_BUILD_TYPE=Release -S . -B build
    cmake --build build

Compiler flags: -O3 -march=native, no LTO

Keys/values: uint64_t keys 1..N, values the same.

Hash functions:
* boost: boost::hash<uint64_t>
* twoway: squirrel3 hash
* absl: absl::Hash<uint64_t>
* std: std::hash<uint64_t>
* flat: std::flat_map<uint64_t, uint64_t> (sorted vector)

Capacity/load factor:
* boost/absl/std reserve(2*N) before inserts (the default).
* twoway grows as needed from capacity 8.
* flat stores N sorted pairs (contiguous).

Lookups grouped by N where
* rows = different hashmap implementation  
* cols = batch size (lookups per iteration, to test repeated lookups in a tight loop)
* cell = cycles per lookup / branch hit rate%

Lookup sets:
* Spare elements: random uniform lookups
* Dense set of elements: sequential lookups (keys[i % N]).
* All lookups are hits.

Tested on:
* OS: Linux
* CPU: Intel Core i7-7700 @ 3.60GHz
* Cores/threads: 4 cores / 8 threads
* L3 cache: 8 MB
* No cpu pinning :(

----------------------------------------------------------------------------------

                                  Spare elements

                                 N = 256 (1 << 8)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 13/100 | 12/100 | 11/100 | 10/100 | 10/100 | 10/100 | 10/100 | 10/100 |
| twoway |  50/87 |  48/85 |  49/81 |  48/80 |  46/81 |  46/81 |  45/81 |  45/82 |
| absl   | 13/100 | 12/100 | 11/100 | 10/100 | 10/100 | 10/100 | 10/100 | 10/100 |
| std    | 31/100 | 28/100 | 27/100 | 28/100 | 28/100 | 28/100 | 29/100 | 29/100 |
| flat   | 162/79 | 174/75 | 164/76 | 160/77 | 158/77 | 157/77 | 157/77 | 157/77 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+


                                N = 1024 (1 << 10)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 13/100 | 12/100 | 11/100 | 11/100 | 11/100 | 10/100 | 11/100 | 10/100 |
| twoway |  52/86 |  50/84 |  51/80 |  50/79 |  49/80 |  48/81 |  47/81 |  47/81 |
| absl   | 13/100 | 11/100 | 11/100 | 10/100 | 10/100 | 10/100 | 10/100 | 10/100 |
| std    | 32/100 | 29/100 | 27/100 | 28/100 | 28/100 | 28/100 | 29/100 | 29/100 |
| flat   | 204/77 | 216/74 | 206/75 | 202/75 | 200/75 | 199/75 | 199/75 | 199/75 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+


                                N = 4096 (1 << 12)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 15/100 | 13/100 | 13/100 | 12/100 | 12/100 | 12/100 | 12/100 | 12/100 |
| twoway |  50/87 |  48/84 |  47/81 |  48/78 |  46/79 |  46/80 |  45/80 |  45/80 |
| absl   | 16/100 | 14/100 | 13/100 | 12/100 | 12/100 | 12/100 | 12/100 | 12/100 |
| std    | 33/100 | 30/100 | 29/100 | 29/100 | 29/100 | 29/100 | 29/100 | 29/100 |
| flat   | 242/77 | 254/74 | 243/75 | 240/75 | 238/75 | 237/75 | 237/75 | 237/75 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+


                               N = 16384 (1 << 14)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 20/100 | 18/100 | 17/100 | 17/100 | 17/100 | 16/100 | 16/100 | 16/100 |
| twoway |  69/86 |  66/84 |  66/80 |  64/79 |  62/80 |  62/80 |  61/81 |  61/81 |
| absl   | 21/100 | 18/100 | 17/100 | 17/100 | 16/100 | 16/100 | 16/100 | 16/100 |
| std    | 41/100 | 37/100 | 36/100 | 36/100 | 35/100 | 35/100 | 36/100 | 35/100 |
| flat   | 303/77 | 315/74 | 304/75 | 300/75 | 299/75 | 298/75 | 298/75 | 297/75 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+


                               N = 65536 (1 << 16)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 23/100 | 20/100 | 20/100 | 19/100 | 19/100 | 19/100 | 19/100 | 19/100 |
| twoway |  59/86 |  56/84 |  55/81 |  57/77 |  55/78 |  54/79 |  53/79 |  53/79 |
| absl   | 27/100 | 22/100 | 20/100 | 19/100 | 19/100 | 19/100 | 19/100 | 19/100 |
| std    | 48/100 | 40/100 | 39/100 | 39/100 | 38/100 | 38/100 | 38/100 | 38/100 |
| flat   | 439/77 | 451/74 | 442/75 | 437/75 | 435/75 | 434/75 | 434/75 | 433/75 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+

----------------------------------------------------------------------------------

                              Dense set of elements

                                 N = 256 (1 << 8)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 13/100 | 11/100 | 10/100 | 10/100 | 10/100 | 10/100 | 10/100 | 10/100 |
| twoway | 12/100 | 10/100 | 10/100 | 10/100 |  9/100 |  9/100 |  9/100 |  9/100 |
| absl   | 13/100 | 11/100 | 11/100 | 10/100 | 10/100 | 10/100 | 10/100 | 10/100 |
| std    | 31/100 | 28/100 | 27/100 | 28/100 | 28/100 | 28/100 | 29/100 | 29/100 |
| flat   |  69/94 |  66/94 |  62/95 |  55/96 |  55/96 |  54/96 |  56/96 |  56/95 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+


                                N = 1024 (1 << 10)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 13/100 | 12/100 | 11/100 | 11/100 | 11/100 | 10/100 | 11/100 | 11/100 |
| twoway | 13/100 | 12/100 | 11/100 | 11/100 | 10/100 | 10/100 | 10/100 | 10/100 |
| absl   | 14/100 | 12/100 | 11/100 | 11/100 | 10/100 | 10/100 | 10/100 | 10/100 |
| std    | 31/100 | 29/100 | 27/100 | 28/100 | 28/100 | 28/100 | 29/100 | 29/100 |
| flat   | 147/85 | 150/84 | 151/83 | 148/83 | 144/84 | 142/84 | 142/84 | 141/84 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+


                                N = 4096 (1 << 12)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 16/100 | 14/100 | 13/100 | 12/100 | 12/100 | 12/100 | 12/100 | 12/100 |
| twoway |  41/90 |  38/89 |  37/87 |  38/85 |  35/86 |  34/87 |  33/88 |  33/88 |
| absl   | 17/100 | 14/100 | 13/100 | 13/100 | 12/100 | 12/100 | 12/100 | 12/100 |
| std    | 31/100 | 28/100 | 27/100 | 28/100 | 28/100 | 28/100 | 29/100 | 29/100 |
| flat   | 151/87 | 162/85 | 155/86 | 154/85 | 152/86 | 150/86 | 149/86 | 148/86 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+


                               N = 16384 (1 << 14)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 22/100 | 20/100 | 19/100 | 18/100 | 18/100 | 18/100 | 18/100 | 18/100 |
| twoway |  61/88 |  59/86 |  59/82 |  58/82 |  56/83 |  54/83 |  53/84 |  53/84 |
| absl   | 21/100 | 19/100 | 17/100 | 17/100 | 17/100 | 17/100 | 16/100 | 16/100 |
| std    | 32/100 | 28/100 | 27/100 | 28/100 | 28/100 | 28/100 | 29/100 | 29/100 |
| flat   | 152/89 | 161/88 | 166/87 | 151/88 | 150/88 | 149/88 | 149/88 | 149/88 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+


                               N = 65536 (1 << 16)
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| kind   |      1 |      2 |      4 |      8 |     16 |     32 |     64 |    128 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| boost  | 26/100 | 21/100 | 20/100 | 20/100 | 20/100 | 20/100 | 20/100 | 20/100 |
| twoway |  55/88 |  52/85 |  52/82 |  54/79 |  52/80 |  51/81 |  50/81 |  50/81 |
| absl   | 26/100 | 21/100 | 20/100 | 19/100 | 19/100 | 19/100 | 19/100 | 19/100 |
| std    | 33/100 | 29/100 | 27/100 | 28/100 | 28/100 | 28/100 | 29/100 | 29/100 |
| flat   | 160/90 | 166/89 | 161/89 | 159/89 | 157/90 | 156/90 | 156/90 | 156/90 |
+--------+--------+--------+--------+--------+--------+--------+--------+--------+
